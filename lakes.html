<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FisherMN - Lakes Map</title>
  <link rel="stylesheet" href="/public/css/tailwind.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="/public/js/navigation.js"></script>
  <script src="/public/js/auth.js"></script>
  <script src="/public/js/ui-controller.js"></script>
  <script src="/public/js/auth-modal.js"></script>
  <style>
    #map {
      height: calc(100vh - 64px);
      width: 100%;
      position: relative;
      z-index: 0;
    }
    /* Ensure Leaflet controls don't exceed modal z-index */
    .leaflet-pane,
    .leaflet-control {
      z-index: 1 !important;
    }
    .leaflet-top,
    .leaflet-bottom {
      z-index: 10 !important;
    }
    .lake-list-item {
      cursor: pointer;
      transition: all 0.2s;
    }
    .lake-list-item:hover {
      transform: translateX(4px);
    }
    .lake-list-item.active {
      border-left: 4px solid #D4AF37;
      background-color: #F4F9FC;
    }
    #lakes-list {
      overflow-y: auto;
      min-height: 0;
    }
  </style>
</head>
<body class="bg-frost overflow-hidden">
  <!-- Auth Modal Loader -->
  <div hx-get="/public/partials/auth-modal.html" hx-trigger="load" hx-swap="beforeend"></div>

  <!-- Left Sidebar - Auth-aware loading -->
  <div id="sidebar-container">
    <aside class="fixed left-0 top-0 h-screen w-64 bg-primary"></aside>
  </div>
  <script>
    (function() {
      var isLoggedIn = !!localStorage.getItem('fishermn_auth_token');
      var url = isLoggedIn ? '/public/partials/sidebar-user.html' : '/public/partials/sidebar-guest.html';
      var el = document.getElementById('sidebar-container');
      el.setAttribute('hx-get', url);
      el.setAttribute('hx-trigger', 'load');
      el.setAttribute('hx-swap', 'outerHTML');
    })();
  </script>

  <!-- Top Bar -->
  <div hx-get="/public/partials/top-bar.html" hx-trigger="load" hx-swap="outerHTML"></div>

  <!-- Main Content Area -->
  <main class="ml-64 mt-16 flex h-[calc(100vh-64px)]">
    <!-- Left Panel: Lakes List -->
    <div class="w-[480px] bg-white border-r border-grayPanel flex flex-col h-[calc(100vh-64px)]">
      <div class="px-6 py-3 border-b border-grayPanel bg-white flex-shrink-0">
        <input
          type="text"
          id="lake-search"
          placeholder="Search lakes..."
          class="w-full px-4 py-2 text-sm rounded-lg border border-grayPanel focus:outline-none focus:ring-2 focus:ring-primary"
          onkeyup="filterLakes()"
        >

        <!-- Ice Thickness Filter -->
        <div class="mt-4 space-y-1">
          <label class="text-xs font-semibold text-secondary">Ice Thickness</label>
          <select id="filter-condition" onchange="applyFilters()" class="w-full px-3 py-2 text-sm rounded-lg border border-grayPanel focus:outline-none focus:ring-2 focus:ring-primary bg-white">
            <option value="">All</option>
            <option value="4">ðŸŸ  4 inches â€“ Single person on foot</option>
            <option value="6">ðŸŸ¡ 6 inches â€“ ATVs and light gear</option>
            <option value="8">ðŸŸ¡ 8 inches â€“ Snowmobiles and small shelters</option>
            <option value="10">ðŸŸ¡ 10 inches â€“ Small cars or heavier setups</option>
            <option value="12">ðŸŸ¢ 12 inches â€“ Light trucks and larger shelters</option>
            <option value="14">ðŸŸ¢ 14 inches â€“ Most pickup trucks</option>
            <option value="16">ðŸŸ¢ 16 inches â€“ Heavy trucks and ice roads</option>
            <option value="18">ðŸŸ¢ 18 inches â€“ Heavy equipment and maximum stability</option>
          </select>
        </div>

        <!-- Filters -->
        <div class="mt-4 bg-white border border-grayPanel rounded-lg overflow-hidden">
          <div class="flex items-center justify-between p-3 cursor-pointer hover:bg-frost transition-colors" onclick="toggleFilters()">
            <div class="flex items-center gap-2">
              <span class="text-xs font-semibold text-secondary">Filters</span>
              <span id="filter-count" class="hidden text-xs bg-gold text-white px-2 py-0.5 rounded-full"></span>
            </div>
            <svg id="filter-chevron" class="w-3 h-3 text-secondary transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
          <div id="filter-content" class="hidden">
            <div class="p-3 pt-0 space-y-3">
              <!-- Bar Counter Filter -->
              <div class="space-y-1">
                <label class="text-xs font-semibold text-secondary">Bars</label>
                <input type="hidden" id="bars-counter" value="0">
                <div class="flex items-center gap-3">
                  <button id="bars-minus" onclick="adjustBarCounter(-1)" class="w-8 h-8 flex items-center justify-center rounded border border-grayPanel bg-white hover:bg-frost text-secondary font-bold disabled:opacity-40 disabled:cursor-not-allowed" disabled>âˆ’</button>
                  <div class="flex items-center gap-2">
                    <span id="bars-count" class="text-lg font-bold text-primary">0</span>
                    <span id="bars-label" class="text-xs text-secondary hidden">or more</span>
                  </div>
                  <button id="bars-plus" onclick="adjustBarCounter(1)" class="w-8 h-8 flex items-center justify-center rounded border border-grayPanel bg-white hover:bg-frost text-secondary font-bold">+</button>
                </div>
              </div>

              <!-- Amenity Checkboxes -->
              <div class="grid grid-cols-2 gap-2">
                <label class="flex items-center gap-2 text-xs cursor-pointer">
                  <input type="checkbox" id="filter-casino" onchange="applyFilters()" class="w-4 h-4 rounded border-grayPanel text-primary focus:ring-primary">
                  <span>Casino</span>
                </label>
                <label class="flex items-center gap-2 text-xs cursor-pointer">
                  <input type="checkbox" id="filter-baitshop" onchange="applyFilters()" class="w-4 h-4 rounded border-grayPanel text-primary focus:ring-primary">
                  <span>Bait Shop</span>
                </label>
                <label class="flex items-center gap-2 text-xs cursor-pointer">
                  <input type="checkbox" id="filter-icehouse" onchange="applyFilters()" class="w-4 h-4 rounded border-grayPanel text-primary focus:ring-primary">
                  <span>Ice House Rental</span>
                </label>
                <label class="flex items-center gap-2 text-xs cursor-pointer">
                  <input type="checkbox" id="filter-lodging" onchange="applyFilters()" class="w-4 h-4 rounded border-grayPanel text-primary focus:ring-primary">
                  <span>Lodging</span>
                </label>
                <label class="flex items-center gap-2 text-xs cursor-pointer">
                  <input type="checkbox" id="filter-restaurant" onchange="applyFilters()" class="w-4 h-4 rounded border-grayPanel text-primary focus:ring-primary">
                  <span>Restaurant</span>
                </label>
                <label class="flex items-center gap-2 text-xs cursor-pointer">
                  <input type="checkbox" id="filter-boatlaunch" onchange="applyFilters()" class="w-4 h-4 rounded border-grayPanel text-primary focus:ring-primary">
                  <span>Boat Launch</span>
                </label>
                <label class="flex items-center gap-2 text-xs cursor-pointer">
                  <input type="checkbox" id="filter-gasstation" onchange="applyFilters()" class="w-4 h-4 rounded border-grayPanel text-primary focus:ring-primary">
                  <span>Gas Station</span>
                </label>
                <label class="flex items-center gap-2 text-xs cursor-pointer">
                  <input type="checkbox" id="filter-grocery" onchange="applyFilters()" class="w-4 h-4 rounded border-grayPanel text-primary focus:ring-primary">
                  <span>Grocery</span>
                </label>
                <label class="flex items-center gap-2 text-xs cursor-pointer">
                  <input type="checkbox" id="filter-guideservice" onchange="applyFilters()" class="w-4 h-4 rounded border-grayPanel text-primary focus:ring-primary">
                  <span>Guide Service</span>
                </label>
              </div>

              <button onclick="clearFilters()" class="text-xs text-primary hover:underline">Clear all filters</button>
            </div>
          </div>
        </div>

      </div>

      <div id="lakes-list" class="p-6 space-y-3 overflow-y-auto flex-1 min-h-0">
        <!-- Loading state - will be replaced by dynamic content -->
        <div class="text-center py-8 text-secondary">
          <div class="animate-pulse">Loading lakes...</div>
        </div>
      </div>
    </div>

    <!-- Right Panel: Interactive Map -->
    <div class="flex-1">
      <div id="map"></div>
    </div>
  </main>

  <!-- Dynamic Lakes Loader -->
  <script src="/public/js/lakes.js"></script>
</body>
</html>
